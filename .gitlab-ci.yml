image: ghcr.io/railwayapp/cli:latest

stages:
  - deploy

# Primer despliegue: Solo Backend
# Railway creará el servicio automáticamente
deploy-server:
  stage: deploy
  script:
    - echo "Desplegando Backend en Railway..."
    # Configurar Account Token correctamente
    - export RAILWAY_API_TOKEN=$RAILWAY_TOKEN
    - unset RAILWAY_TOKEN
    - echo "Token configurado como API Token"
    - cd server
    # Vincular al proyecto usando el ID
    - railway link 87435885-818a-47cd-95c2-da747d5a9c45
    - railway up --service c8608e6b-e98c-4030-b1fc-8547423c9984 --detach
  only:
    - main
  environment:
    name: production

# Descomentar después del primer despliegue exitoso del backend
# deploy-client:
#   stage: deploy
#   script:
#     - echo "Desplegando Frontend en Railway..."
#     - cd client
#     - railway up --detach
#   only:
#     - main
