image: ghcr.io/railwayapp/cli:latest

stages:
  - deploy

# Primer despliegue: Solo Backend
# Railway creará el servicio automáticamente
deploy-server:
  stage: deploy
  script:
    - echo "Desplegando Backend en Railway..."
    - cd server
    # Autenticar usando el token
    - railway link --environment production
    - railway up --detach
  only:
    - main
  environment:
    name: production

# Descomentar después del primer despliegue exitoso del backend
# deploy-client:
#   stage: deploy
#   script:
#     - echo "Desplegando Frontend en Railway..."
#     - cd client
#     - railway link --environment production
#     - railway up --detach
#   only:
#     - main
